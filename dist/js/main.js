!function(e,t){var s={msgPushIndex:0,msgTab:[],userTab:[],FirstTimeRefresh:!0,callkwickAPI:function(e,a){let s=t.ajax({type:"GET",url:"http://greenvelvet.alwaysdata.net/kwick/api/"+e,dataType:"jsonp"});s.fail(function(e,s,t){a(s,null),console.log("Error")}),s.done(function(e){a(null,e),console.log("Done With succeess")})}};e.kwick=s}(window,jQuery),kwick.login=function(a){$("#login-form").on("submit",function(e){e.preventDefault();var t,s=$("#username").val(),e=$("#password").val();""===s?$(".card-info").empty().append('<div class="card-panel red white-text"> Please enter your Username !</div>'):""===e?$(".card-info").empty().append('<div class="card-panel red white-text"> Please enter your Password !</div>'):(t=s,e=e,kwick.callkwickAPI("login/"+t+"/"+e,function(e,s){e&&console.log("The server doesn't respond"),"done"==s.result.status?(localStorage.setItem("user_token",s.result.token),localStorage.setItem("user_id",s.result.id),localStorage.setItem("user_name",t),localStorage.setItem("message",s.result.message),$(".card-info").empty(),a()):$(".card-info").empty().append('<div class="card-panel red white-text">'+s.result.message+"</div>")}))})},kwick.login(function(){document.location.href="./messagerie.html"}),kwick.messagerie=function(t){var a=localStorage.getItem("user_token"),l=localStorage.getItem("user_id");let o=localStorage.getItem("user_name");localStorage.getItem("message");function e(e){kwick.callkwickAPI("user/logged/"+e,function(e,t){e&&console.log("Fail To get List");let a;if(0==kwick.firstTimeRefresh&&kwick.userTab.length<t.result.user.length)for(let s=0;s<t.result.user.length;s++){a=!0;for(let e=0;e<kwick.userTab.length;e++)if(0<=kwick.userTab[e].indexOf(t.result.user[s])){a=!1;break}1==a&&console.log(t.result.user[s]+"is connected")}if(0==kwick.firstTimeRefresh&&kwick.userTab.length>t.result.user.length)for(let s=0;s<kwick.userTab.length;s++){userDisconnected=!0;for(let e=0;e<t.result.user.length;e++)if(0<=kwick.userTab[s].indexOf(t.result.user[e])){userDisconnected=!1;break}1==userDisconnected&&console.log(t.result.user[s]+"is disconnected")}kwick.userTab=[],$(".info-user").empty();for(let e=0;e<t.result.user.length;e++)kwick.userTab.push(t.result.user[e]),s=kwick.userTab[e],$(".info-user").append('<div class="info-name-status"><span class="info-name"> '+s+'<span class="info-status">online</span></span></div>');var s;kwick.firstTimeRefresh=!1})}function n(e,n){kwick.callkwickAPI("talk/list/"+e+"/0",function(e,s){e&&console.log("Fail");var t,a;kwick.msgTab=[];for(let e=s.result.talk.length-n;e<s.result.talk.length;e++){var l=new Date(1e3*s.result.talk[e].timestamp).toLocaleTimeString();kwick.msgTab.push((t=s.result.talk[e].user_name,a=s.result.talk[e].content,l=l,t!=o?'<li class="clearfix"><div class="message-data align-right"><span class="message-data-time">'+l+'</span><span class="message-data-name"></span>'+t+'<i class="fa fa-circle me"></i></div><div class="message other-message float-right">'+a+"</div></li>":'<li class="clearfix"><div class="message-data align-left"><span class="message-data-name"> <i class="fa fa-circle online"></i></span>'+t+'<span class="message-data-time">'+l+'</span></div><div class="message my-message float-right">'+a+"</div></li>"))}$(".chat-history ul").empty().append(kwick.msgTab),kwick.msgPushIndex<s.result.talk.length&&(s.result.talk.length,kwick.msgPushIndex,$("#msg-box").scrollTop(1e10),0!==kwick.msgPushIndex&&s.result.talk[s.result.talk.length-1].user_name!==o&&console.log("New Message Added")),kwick.msgPushIndex=s.result.talk.length})}null===a&&null===l&&(document.location.href="./redirection.html"),$("#logout").on("click",function(){var e,s;e=a,s=l,kwick.callkwickAPI("logout/"+e+"/"+s,function(e,s){e&&console.log("fail"),localStorage.removeItem("user_name"),localStorage.removeItem("user_id"),localStorage.removeItem("user_token"),t()})}),$(".compte-info").on("click",function(){$(".menu-dropdown").toggleClass("open")}),$("#form-message").on("submit",function(e){e.preventDefault();var s,t=$("#message-to-send").val();t.length<140&&""!==t&&(s=encodeURIComponent(t),e=a,t=l,s=s,kwick.callkwickAPI("say/"+e+"/"+t+"/"+s,function(e,s){e&&console.log("fail")}),$("#message-to-send").val(""),n(a,kwick.msgTab.length))}),e(a),n(a,15),setInterval(function(){n(a,kwick.msgTab.length),e(a)},7e3),$(".chat-history").on("scroll",function(){0==$(".chat-history").scrollTop()?$("#previous").show():$("#previous").hide()}),$("#previous").on("click",function(){n(a,kwick.msgTab.length+15)})},""===$(".messagerie-content").val()&&kwick.messagerie(function(){document.location.href="./index.html"}),kwick.register=function(l){$("#register-form").on("submit",function(e){e.preventDefault();var t,s=$("#username").val(),a=$("#password").val(),e=$("#confirm-password").val();""===s?$(".card-info").empty().append('<div class="card-panel red white-text"> Please enter your Username !</div>'):""===a?$(".card-info").empty().append('<div class="card-panel red white-text"> Please enter your Password !</div>'):a!==e?$(".card-info").empty().append('<div class="card-panel red white-text"> Confirm password doesn\'t match !</div>'):(t=s,a=a,kwick.callkwickAPI("signup/"+t+"/"+a,function(e,s){e&&console.log("err"),"done"==s.result.status?(localStorage.setItem("user_token",s.result.token),localStorage.setItem("user_id",s.result.id),localStorage.setItem("user_name",t),localStorage.setItem("message",s.result.message+", you can use the messenger now !"),l()):$(".card-info").empty().append('<div class="card-panel red white-text">'+s.result.message+"</div>")}))})},kwick.register(function(){document.location.href="./messagerie.html"});